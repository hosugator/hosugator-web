---
created: 2025-11-16
tags:
  - aws_saa
  - aws
  - step_functions
  - serverless
  - workflow
  - orchestration
reference:
---
# AWS Step Functions
## 정의
분산 애플리케이션을 시각적 워크플로우로 조정하는 서버리스 오케스트레이션 서비스

## 원리
### State Machine
- 상태 머신(State Machine)이라고 불리는 워크플로우를 Amazon States Language (ASL)라는 JSON 기반 구조로 정의한다.
- 이 상태 머신은 다양한 상태(State)로 구성되며, 각 상태는 작업을 수행하거나(Task), 결정을 내리거나(Choice), 대기(Wait)하거나, 병렬로 실행(Parallel)하는 등의 역할을 한다.

### 작업 오케스트레이션
- 각 상태는 [[Lambda]] 함수, [[ECS]], [[SQS]], [[DynamoDB]]와 같은 다른 AWS 서비스를 호출하는 작업(Task)을 수행한다.
- Step Functions는 각 단계의 실행을 관리하고 상태 변화를 추적한다.

## 요소
- 상태 머신(State Machine): 워크플로우의 전체 구조와 논리를 정의하는 최상위 엔티티이다.
- 상태(State): 상태 머신 내의 기본 구성 요소이다. 종류에는 Task, Choice, Parallel, Map, Wait, Success, Fail 등이 있다.
- 작업(Task): 특정 작업을 수행하기 위해 호출되는 AWS 리소스(예: Lambda 함수)이다.
- Amazon States Language (ASL): 상태 머신을 정의하는 JSON 기반 언어이다.

## 특징
- 시각적 워크플로우: AWS 콘솔에서 상태 머신을 시각적으로 설계, 실행, 모니터링할 수 있어 복잡한 로직을 쉽게 이해할 수 있다.
- 내장된 오류 처리: 재시도(Retry), 포착(Catch), 타임아웃(Timeout)과 같은 기능을 내장하고 있어, 각 단계에서 오류가 발생하더라도 안정적인 워크플로우를 보장한다.
- 동기 및 비동기 실행: 동기식(응답을 기다림) 및 비동기식(응답을 기다리지 않고 계속 진행) 호출 방식을 모두 지원한다.
- 두 가지 유형:
    - 표준(Standard): 장기 실행(최대 1년) 및 감사 요구 사항이 있는 워크플로우에 적합하다.
    - 고속(Express): 짧은 실행 시간(최대 5분) 및 대규모 이벤트 처리(예: IoT, 데이터 스트리밍)에 적합하다.

## 비교
| 구분 | Step Functions | [[SQS]] + [[Lambda]] |
| :--- | :--- | :--- |
| 목적 | 오케스트레이션 (다단계, 순차적 흐름 제어) | 디커플링 (메시지 대기열을 통한 비동기적 통신) |
| 흐름 제어 | 중앙 집중식 상태 머신이 전체 흐름을 명시적으로 제어 | 메시지 소비자(Lambda)가 다음 단계를 결정 |
| 적합한 경우 | 복잡한 비즈니스 로직, 마이크로서비스 조정, 장기 실행 작업 | 대용량 메시지 처리, 단순한 큐잉 및 팬아웃 |

## 예시
- 주문 처리 워크플로우:
    1. 사용자가 주문을 완료하면 Step Functions 상태 머신이 시작된다.
    2. Task 상태가 [[Lambda]] 함수를 호출하여 결제 처리를 수행한다.
    3. Choice 상태가 결제 성공/실패 여부를 확인한다.
    4. 성공 시 Parallel 상태가 동시에 재고 업데이트 [[ECS]] 작업과 사용자에게 알림을 보내는 [[SNS]] 작업을 실행한다.
    5. 실패 시 Task 상태가 사용자에게 오류 메시지를 보내고 Fail 상태로 워크플로우를 종료한다.