---
created: 2025-10-12
tags:
  - data_preprocessing
  - demand_forecasting
  - logistics_center
  - data_cleaning
  - feature_engineering
  - time_series
  - outlier_treatment
  - supply_chain_demand_forecasting
  - kdlc
reference:
  - "[[kdlc - hub]]"
---
> **Last revised:** `= dateformat(this.file.mtime, "yyyy-MM-dd HH:mm")`

# 물류센터 수요 예측 데이터 전처리 과정

## 데이터 전처리 핵심 용어 정의
### 데이터 전처리 핵심 용어 정의표
| 용어 | 정의 |
| :--- | :--- |
| **매출 데이터** | 물류센터의 상품 **판매일**, **수량**, **금액** 등을 기록한 데이터 (A: 184만 건, B: 172만 건). |
| **매입 데이터** | 물류센터의 상품 **입고일**, **수량**, **금액** 등을 기록한 데이터. |
| **타겟 카테고리** | A 물류센터(중분류), B 물류센터(소분류) 기준으로 수요 예측 대상으로 **선정된 상품군**. |
| **반품 데이터 정규화** | **반품** 건의 **수량**을 **음수**로 통일하여 **순수요(net demand)** 계산을 가능하게 하는 처리 과정. |
| **시계열 변수 가공** | $\text{Lag}$, $\text{Rolling}$, $\text{Diff}$ 등 과거 데이터를 활용하여 **트렌드**와 **계절성**을 포착하기 위해 생성된 변수. |
| **외부 데이터** | **수요**에 영향을 미치는 **공휴일**, **날씨**, **경제 지표** 등 외부 요인을 반영하기 위해 병합된 데이터. |

## 데이터 개요 및 통합
### 데이터셋 개요 및 통합 범위
**기간**은 2021년 1월부터 2024년 12월까지의 기록을 포함한다.
원본 데이터는 **매출 데이터**와 **매입 데이터**로 구성된다.
**매출 데이터**는 A 물류센터 1,843,835건, B 물류센터 1,729,730건이며, **매입 데이터**는 A 물류센터 227,534건, B 물류센터 345,021건이다.
**데이터 통합**은 3개의 분리된 매출 파일 ($\text{2021~2023 배포용.xlsx}$의 2개 시트 및 $\text{2024 배포용.xlsx}$)의 컬럼명 불일치를 해결하여 최종 병합하는 방식으로 진행되었다.
주요 컬럼 통일 작업은 '공급금액', '부가세(과세)', '매출처 우편번호', '바코드', '옵션 코드'에 대해 수행되었다.

### 결측치 현황 및 타겟 카테고리 선정
데이터 내 **소분류** 컬럼은 A 물류 매출 51.68%, B 물류 매입 68.79% 등 높은 **결측치** 비율을 보였고, **중분류**는 B 물류 매입에서 67.69%로 높게 나타났다.
**수요 예측**의 효율성을 위해 **타겟 카테고리**를 선정하여 데이터를 필터링했다.
**A 물류센터**는 **중분류** 기준으로 **생수, 음료, 건강, 신선식품**을 선정했다.
**B 물류센터**는 **소분류** 기준으로 **탄산음료, 봉지라면**을 선정했다.
선정 결과, A 물류센터 **매출**은 296,058건 (16.1%), B 물류센터 **매출**은 82,074건 (4.7%)으로 데이터가 **필터링**되었다.

## 핵심 데이터 클리닝
### 테스트 데이터 및 이상치 처리
**테스트 데이터** (우편번호 = '00000')는 A, B 물류센터 모두에서 해당 건이 없어 제거되지 않았다.
**이상치**는 99% $\text{percentile}$ 기준으로 검토되었으며, 대량 주문, 프로모션 등 **실제 비즈니스 상황**을 반영하며 물류센터 특성상 대량 거래 발생 가능성이 높다고 판단하여 **제거하지 않고 유지**되었다.

### 반품 데이터 정규화
**문제점:** 반품 데이터에서 **판매 수량**이 **음수(-)와 양수(+)가 혼재**하는 입력 방식의 불일치가 발견되었다.
**처리:** 구분='반품', '반출', '취소'이면서 수량 $>0$인 경우 수량에 $\text{-1}$을 곱하여 **음수**로 통일했다.
**효과:** 이 정규화 작업을 통해 수요 예측 시 반품을 정확히 **수요 감소 요인**으로 반영하여 **순수요 (net demand)** 계산이 가능해졌다.

## 변수 선택 및 가공
### 기본 시간 변수 및 핵심 컬럼 선택
**파생 변수:** $\text{year, month, day, dayofweek, quarter, week}$를 생성하여 **계절성**, **요일별 트렌드**, **월말/월초 효과** 등을 포착한다.
**최종 선택 변수:** 시간 정보 (7개), 거래 정보 (구분, **수량**), 상품 정보 (중/소분류), 금액 정보 (공급금액, 부가세), 물류 정보 (입수/EA) 등 **수요예측에 직접 기여**하는 13~14개 핵심 컬럼을 유지했다.

### 시계열 특징 변수 (Time Series Features) 생성
수요 예측의 정확도를 높이기 위해 과거 시점의 정보를 활용하는 특징 변수들을 생성했다.
* **Lag Features:** $\text{수량\_lag\_1}$부터 $\text{수량\_lag\_52}$까지 생성하여 **최근 트렌드** 및 **전년 동기 대비 계절성**을 포착한다.
* **Rolling Features:** $\text{수량\_rolling\_mean\_4}$ 등을 생성하여 **4주 평균**으로 **평활화된 트렌드**를 파악하고 변동성을 측정한다.
* **Diff Features:** $\text{수량\_diff\_1}$ (전주 대비 변화량) 등을 생성하여 **수요 증감 추세**를 감지한다.
* **Expanding Features:** $\text{수량\_expanding\_mean}$ (누적 평균) 등을 생성하여 **장기 트렌드** 및 안정성을 평가한다.
* **Interaction Features:** $\text{temp\_heatwave\_interaction}$ (기온 $\times$ 폭염) 등 **복합 요인의 시너지 효과**를 포착하는 변수를 생성했다.

### 시계열 변수 결측치 처리
시계열 변수 생성 시 발생하는 초기 기간의 결측치 (최대 $\text{lag\_52}$로 인한 52주)는 데이터 분석 범위에서 **제거**되었다.

## 외부 데이터 병합
### 수요 예측력 강화를 위한 외부 요인
**수요**에 영향을 미치는 외부 요인을 반영하기 위해 다양한 데이터를 병합했다.
* **공휴일:** **한국 공휴일** 여부 ($\text{Is\_Holiday}$) 및 **연휴 효과** ($\text{대목 7일전 여부}$)를 **일별**로 반영했다.
* **날씨/기후:** 평균 기온, 기온 편차, 온도 변화 및 **폭염, 한파** 여부 등 극한 기후 정보를 **일별**로 병합했다.
* **경제/금융:** 소비자 물가 상승률, **소비자 심리 지수**, 한국은행 기준금리 등의 경제 지표를 **일별로 보간**하여 반영했다.
* **특수 요인:** 2021년부터 2023년까지의 코로나19 관련 **집합 금지 조치** 여부 변수를 포함했다.