---
created: 2025-10-12
tags: [kdlc, external_data_integration, feature_engineering, time_series_forecasting, demand_drivers, seasonal_adjustment, postal_code_analysis]
reference:
  - "[[kdlc - hub]]"
---
> **Last revised:** `= dateformat(this.file.mtime, "yyyy-MM-dd HH:mm")`

# 외부 데이터 수집 및 병합 전략

## 외부 데이터 수집 및 가공 목록
수요 예측 모델의 예측력을 높이기 위해 공휴일, 경제 지표, 날씨 등 주요 외부 변수를 수집하고 날짜를 기준으로 메인 데이터에 병합했다.

### 1. 시간 및 휴일 변수
| 데이터 | 출처 | 설명 | 가공/활용 |
| :--- | :--- | :--- | :--- |
| 공휴일 | 파일 | 주말을 제외한 법정 공휴일 여부 (Is_Holiday=1인 경우). | 주말/평일 공휴일 효과 분석에 활용. |
| 대목 직전 7일 | 파일 | 설날, 추석 당일 및 연휴 직전 7일간의 대목 특수 여부. | 명절 대목 특수 수요 포착 변수. |
| 시계열 주기성 | 자체 생성 | 요일 및 월의 주기성을 나타내는 sin/cos 변환 값. | 계절성 및 요일 효과를 원형 구조로 인코딩하여 모델 학습에 활용. |

### 2. 경제 및 정책 변수
| 데이터 | 출처 | 설명 | 가공/활용 |
| :--- | :--- | :--- | :--- |
| 소비자 심리 지수 (CCSI) | ECOS | 장기 평균(100) 대비 소비 심리 낙관/비관 정도. | 스플라인 보간법으로 일별 데이터 생성 후 소비 심리 반영. |
| 소비자 물가 상승률 | 국가데이터처 | 월별 물가 변동률. | 스플라인 보간법으로 일별 데이터 생성 후 인플레이션 영향 반영. |
| 한국은행 기준금리 | ECOS | 금융 정책 환경 지표. | 일별 보간 후 금리 변화에 따른 소비 위축/확장 심리 반영. |
| 코로나 집합금지 | 파일 | 2021~2023년 집합 금지 조치 여부 (2024년 false). | 특수 환경 요인(락다운 등)에 따른 수요 변화 반영. |

### 3. 기상 및 극한 기후 변수 (전국 평균)
| 변수명 | 정의 | 계산식 / 조건 | 중요성 |
| :--- | :--- | :--- | :--- |
| 평균기온 | 일평균 기온 (°C). | 원본 데이터 사용. | 기본적인 온도 효과 반영. |
| 기온편차 | 평년 대비 기온 차이. | 해당일 평균기온 - 해당월 평년 평균. | 체감 온도와 이례적 날씨 수요 변화 포착. |
| 온도변화_7일 | 지난주 같은 요일 대비 온도 변화. | 오늘 평균기온 - 7일 전 평균기온. | ± 5°C 이상의 급격한 온도 변화에 따른 수요 급변 감지. |
| 여름_폭염 | (6~8월) AND (최고기온 ≥ 33°C). | 기상청 폭염주의보 기준에 준함. | 여름 상품(음료, 생수) 수요 급증 포착. |
| 겨울_한파 | (12~2월) AND (최저기온 ≤ -10°C). | 기상청 한파주의보 기준에 준함. | 겨울 상품(봉지라면) 수요 증가 포착. |

## 시계열 주기성 sin/cos 변환의 중요성
시계열 변수(요일, 월)를 주기적인 특성에 맞게 모델에 반영하기 위해 sin/cos 변환을 적용했다.
단순히 요일(0~6)이나 월(1~12)을 숫자로 인코딩하면, 주기(예: 일요일 6과 월요일 0)의 시작점과 끝점이 멀리 떨어진 것으로 인식되어 모델 학습에 오류를 유발한다.
sin(2π * month / 12)와 cos(2π * month / 12)를 함께 사용하여 주기적 변수를 원 위의 고유한 좌표로 표현함으로써, 12월과 1월 같은 인접성이 정확히 수치화된다. 
이는 주말 수요 증가, 계절성 수요 변화 등 뚜렷한 주기적 패턴을 가진 물류 데이터의 예측에 필수적이다.

## 지역 정보 기반의 수요 분석 (우편번호 분석)
물류센터의 우편번호를 활용하여 지역적 특성과 수요 패턴을 분석했다.

| 구분 | A 물류센터 | B 물류센터 | 시사점 |
| :--- | :--- | :--- | :--- |
| 담당 지역 | 주로 37xx (경기/인천) | 주로 51xx (경기/강원) | 두 센터는 독립적인 지역을 담당하므로 별도의 예측 모델이 필요하다. |
| 지역 커버리지 | 236개 지역 | 576개 지역 | B센터가 더 넓은 지역을 커버한다. |
| 매출 집중도 | 상위 5개 지역에 매출 집중 | 상대적으로 매출 구조 분산 | A센터는 상위 지역 집중 관리를 통한 효율성 향상 가능. |

활용 방안: 우편번호의 자릿수 패턴을 이용해 A/B 물류센터 데이터를 필터링하고, B 물류센터의 경우 매출 비중이 높은 특정 지역(51341)에 대한 집중 분석이 가능하다.

## 모델링 및 타겟 변수 설정
* 핵심 변수 전략: 공휴일, 대목 전 7일, 코로나 여부, 시계열 sin/cos 변환 등 시간 및 이벤트 기반 변수를 필수로 포함하고, 기온/강수량 등 날씨 정보는 검증 시간을 고려하여 초기 모델에서는 제외하고 다른 추가 변수를 통해 차별화를 꾀한다.
* 물가 지표 생성 필요: 현재 공급금액과 부과세 컬럼을 가져갈 수 없는 상황이므로, 새로운 물가 지표 (단가 변화 등)를 생성하는 것은 제한된다. 모델에 포함될 가격 관련 변수는 '공급금액'과 '부과세' 그 자체로만 활용된다.
* 타겟 변수: 모델의 타겟 피쳐는 판매 수량이며, 다음 카테고리별로 각기 다른 모델이 도출되어야 한다.
    * A 물류센터: (생수, 음료, 건강), 신선식품
    * B 물류센터: 봉지라면, 탄산음료